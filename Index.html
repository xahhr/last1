<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªØ¹Ø§ÙÙŠ 63 ğŸŒ¿ â€“ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† 15 Ù…Ø¬Ù…</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
body{font-family:'Cairo',sans-serif;background:#f8f9fa;color:#222;margin:0;line-height:1.6}
header{background:#fff;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,0.1);position:sticky;top:0;z-index:10}
h1{font-size:22px;margin:0;background:linear-gradient(90deg,#2ecc71,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.wrap{max-width:1100px;margin:auto;padding:12px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.card{grid-column:span 12;background:#fff;border-radius:16px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
@media(min-width:900px){.half{grid-column:span 6}}
.btn{padding:10px 16px;border:none;border-radius:12px;cursor:pointer;margin:4px;font-size:14px}
.btn.a{background:#2ecc71;color:#fff}.btn.w{background:#f39c12;color:#fff}
.pill{padding:6px 14px;border-radius:30px;background:#e8f5e9;font-size:13px;display:inline-flex;align-items:center;gap:6px}
.bar{height:10px;background:#eee;border-radius:5px;overflow:hidden;margin:10px 0}
.bar span{display:block;height:100%;background:linear-gradient(90deg,#3498db,#2ecc71);transition:0.5s}
.table{width:100%;border-collapse:collapse;font-size:14px}
.table th{background:#f0f8ff;padding:12px}
.table td{padding:10px;text-align:center;border-bottom:1px solid #eee}
.tip{background:#e8f5ff;padding:16px;border-radius:12px;border-right:5px solid #3498db;margin:12px 0;font-size:15px}
.mood{padding:12px 20px;border-radius:30px;background:#f0f0f0;cursor:pointer;transition:.3s}
.mood.active{background:#d5f5e3;border:2px solid #2ecc71}
.supp label{display:flex;align-items:center;gap:12px;padding:12px;background:#f9f9f9;border-radius:10px;margin:6px 0;cursor:pointer;font-size:15px}
#chart{height:220px !important}
dialog{background:#fff;padding:25px;border-radius:16px;border:none;box-shadow:0 10px 40px rgba(0,0,0,0.3);max-width:90%;width:500px}
dialog::backdrop{background:#00000099}
input{padding:10px;border-radius:8px;border:1px solid #ddd;width:100%;margin:5px 0}
</style>
</head>
<body>

<header>
  <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
    <h1>ØªØ¹Ø§ÙÙŠ 63 ğŸŒ¿ â€“ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† 15 Ù…Ø¬Ù… Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†</h1>
    <div>
      <button class="btn" id="openInv">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ğŸ“¦</button>
      <button class="btn" id="prevDay">â¬… Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      <button class="btn" id="nextDay">Ø§Ù„ØªØ§Ù„ÙŠ â¡</button>
      <button class="btn w" id="resetStart">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ğŸ“…</button>
      <button class="btn a" id="saveDay">Ø­ÙØ¸ Ø§Ù„ÙŠÙˆÙ… âœ…</button>
    </div>
  </div>
  <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap;align-items:center">
    <span class="pill">Ø¨Ø¯Ø¡: <b id="startDateLabel"></b></span>
    <span class="pill">ÙŠÙˆÙ… <b id="dayIdxLabel">1</b>/63</span>
    <span class="pill">Ø£Ø³Ø¨ÙˆØ¹ <b id="weekLabel">1</b></span>
    <span class="pill" style="background:#d5f5e3">ØªÙ‚Ø¯Ù… <b id="progressText">0%</b></span>
    <div class="bar" style="flex:1"><span id="progressBar" style="width:0%"></span></div>
  </div>
</header>

<div class="wrap"><div class="grid">

  <div class="card"><h3>Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨ ğŸ“‰</h3><canvas id="chart"></canvas></div>

  <div class="card"><h3>Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… ğŸ¯</h3><p id="targetsText" style="font-size:19px;font-weight:600"></p></div>

  <div class="card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</h3>
    <table class="table">
      <tr><th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th><th>Ø§Ù„Ù‡Ø¯Ù</th><th>Ø£ÙØ®Ø°</th></tr>
      <tr><td>Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†</td><td id="t_eso">15</td><td><input type="number" step="0.5" data-k="eso"></td></tr>
      <tr><td>Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†</td><td id="t_gab">2200</td><td><input type="number" step="50" data-k="gab"></td></tr>
      <tr><td>Ù…Ù†Ø´Ø·Ø§Øª</td><td id="t_stim">650</td><td><input type="number" step="25" data-k="stim"></td></tr>
      <tr><td>ÙƒØ§ÙÙŠÙŠÙ† â‰¤</td><td id="t_caf">350</td><td><input type="number" step="10" data-k="caf"></td></tr>
    </table>
    <button class="btn" id="voiceNote">ğŸ¤ Ù…Ù„Ø§Ø­Ø¸Ø© ØµÙˆØªÙŠØ©</button>
  </div>

  <div class="card">
    <h3>Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ… ğŸ’¡</h3>
    <div id="dailyTip" class="tip"></div>
  </div>

  <div class="card half">
    <h3>Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ğŸ’Š (Ø¶Ø¹ Ø¹Ù„Ø§Ù…Ø© âœ“)</h3>
    <div class="supp">
      <label><input type="checkbox"> Ù…ØºÙ†ÙŠØ³ÙŠÙˆÙ… Ø¬Ù„Ø§ÙŠØ³ÙŠÙ†Ø§Øª 400 Ù…Ø¬Ù…</label>
      <label><input type="checkbox"> Ù„Ù€ Ø«ÙŠØ§Ù†ÙŠÙ† 200â€“400 Ù…Ø¬Ù…</label>
      <label><input type="checkbox"> Ù…ÙŠÙ„Ø§ØªÙˆÙ†ÙŠÙ† 0.5â€“1 Ù…Ø¬Ù… (Ø¥Ø°Ø§ Ù„Ø²Ù…)</label>
      <label><input type="checkbox"> Ø£ÙˆÙ…ÙŠØ¬Ø§-3 Ø¹Ø§Ù„ÙŠ EPA/DHA</label>
      <label><input type="checkbox"> ÙÙŠØªØ§Ù…ÙŠÙ† Ø¯ 5000 ÙˆØ­Ø¯Ø©</label>
      <label><input type="checkbox"> ÙÙŠØªØ§Ù…ÙŠÙ† Ø¨ Ø§Ù„Ù…Ø±ÙƒØ¨</label>
      <label><input type="checkbox"> Ø£Ø´ÙˆØ§Ø¬Ù†Ø¯Ø§ Ø£Ùˆ Ø±ÙˆØ¯ÙŠÙˆÙ„Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    </div>
  </div>

  <div class="card half">
    <h3>Ù…Ø²Ø§Ø¬Ùƒ Ø§Ù„ÙŠÙˆÙ…</h3>
    <div style="display:flex;gap:12px;justify-content:center;margin:20px 0">
      <span class="mood" onclick="setMood(1)">ğŸ˜” Ù…ÙƒØªØ¦Ø¨</span>
      <span class="mood" onclick="setMood(2)">ğŸ˜° Ù…ØªÙˆØªØ±</span>
      <span class="mood active" onclick="setMood(3)">ğŸ˜ Ø¹Ø§Ø¯ÙŠ</span>
      <span class="mood" onclick="setMood(4)">ğŸ™‚ Ø¬ÙŠØ¯</span>
      <span class="mood" onclick="setMood(5)">ğŸ˜ Ù…Ù…ØªØ§Ø²</span>
    </div>
    <textarea id="notes" rows="4" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…... Ø£ÙŠ Ø£Ø¹Ø±Ø§Ø¶ØŸ ÙƒÙ… Ù†Ù…ØªØŸ"></textarea>
  </div>

  <div class="card">
    <h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ğŸ“¦</h3>
    <table class="table" id="invTable"><tbody></tbody></table>
  </div>

</div></div>

<dialog id="invDlg">
  <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
  <div id="invForm"></div>
  <div style="margin-top:20px;text-align:left">
    <button class="btn" onclick="document.getElementById('invDlg').close()">Ø¥Ù„ØºØ§Ø¡</button>
    <button class="btn a" id="saveInv">Ø­ÙØ¸</button>
  </div>
</dialog>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const TOTAL_DAYS = 63;
const LS_START = "t63_start", LS_DATA = "t63_data", LS_INV = "t63_inv";
let currentDay = 1, currentMood = 3, chart = null;

const targets = {
  eso: [0,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,14,14,14,14,12,12,12,12,12,12,12,10,10,10,10,10,10,10,8,8,8,8,8,8,8,6,6,6,6,6,6,6,4,4,4,4,4,4,4,2,2,2,1,1,1,0],
  gab: [0,2200,2200,2200,2200,2200,2200,2200,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,1800,1800,1800,1800,1800,1600,1600,1600,1600,1600,1600,1600,1400,1400,1400,1400,1400,1400,1400,1200,1200,1200,1200,1200,1200,1200,1000,1000,1000,1000,1000,1000,1000,800,800,800,800,800,800,800,600,600,600,300,300,300,0],
  stim: [0,650,650,650,650,650,650,650,600,600,600,600,600,600,600,600,600,600,600,600,550,550,550,550,550,500,500,500,500,500,500,500,400,400,400,400,400,400,400,300,300,300,300,300,300,300,200,200,200,200,200,200,200,100,100,100,100,100,100,100,50,50,50,0,0,0,0],
  caf: [0,350,350,350,350,350,350,350,300,300,300,300,300,300,300,300,300,300,300,300,250,250,250,250,250,200,200,200,200,200,200,200,150,150,150,150,150,150,150,100,100,100,100,100,100,100,75,75,75,75,75,75,75,50,50,50,50,50,50,50,30,30,30,10,10,10,0]
};

const drugInfo = {
  eso: {name:"Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†", mg:3, tabsPerBox:20},
  gab: {name:"Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†", mg:300, tabsPerBox:30},
  stim: {name:"Ù…Ù†Ø´Ø·Ø§Øª (Ù…Ø¹Ø§Ø¯Ù„)", mg:150, tabsPerBox:30}
};

const tips = [
  "ğŸ’§ Ø§Ø´Ø±Ø¨ 3â€“4 Ù„ØªØ± Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠÙ‹Ø§ â€“ ÙŠØ®ÙÙ ÙƒÙ„ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§",
  "ğŸ§˜â€â™‚ï¸ Ù…ØºÙ†ÙŠØ³ÙŠÙˆÙ… Ø¬Ù„Ø§ÙŠØ³ÙŠÙ†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… = Ø³Ø­Ø± Ù„Ù„Ù‚Ù„Ù‚ ÙˆØ§Ù„Ø¹Ø¶Ù„Ø§Øª",
  "ğŸƒâ€â™‚ï¸ 20 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø´ÙŠ ÙŠÙˆÙ…ÙŠÙ‹Ø§ ØªÙ‚Ù„Ù„ Ø§Ù„Ù‚Ù„Ù‚ Ø¨Ù†Ø³Ø¨Ø© ÙƒØ¨ÙŠØ±Ø©",
  "â˜• ØªØ¬Ù†Ø¨ Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ† Ø¨Ø¹Ø¯ 2 Ø¸Ù‡Ø±Ù‹Ø§",
  "ğŸ› Ø­Ù…Ø§Ù… Ø¯Ø§ÙØ¦ + Ù…Ù„Ø­ Ø¥Ø¨Ø³ÙˆÙ… = Ø¹Ù„Ø§Ø¬ Ù…Ù†Ø²Ù„ÙŠ Ù…Ù…ØªØ§Ø²",
  "ğŸŒ¬ ØªÙ†ÙØ³ 4-7-8 Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª ÙŠÙˆÙ‚Ù Ù†ÙˆØ¨Ø§Øª Ø§Ù„Ù‚Ù„Ù‚ ÙÙˆØ±Ù‹Ø§",
  "ğŸŸ Ø£ÙˆÙ…ÙŠØ¬Ø§-3 Ø¹Ø§Ù„ÙŠ EPA ÙŠØ­Ø³Ù† Ø§Ù„Ù…Ø²Ø§Ø¬ Ø®Ù„Ø§Ù„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†",
  "â° Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù†ÙˆÙ… Ø«Ø§Ø¨ØªØ© Ø­ØªÙ‰ Ù„Ùˆ 4 Ø³Ø§Ø¹Ø§Øª ÙÙ‚Ø·"
];

function getStartDate(){
  let s = localStorage.getItem(LS_START);
  if(!s){let d=new Date(); d.setHours(0,0,0,0); localStorage.setItem(LS_START,d.toISOString()); s=d.toISOString();}
  return new Date(s);
}
function getCurrentDay(){
  const diff = Date.now() - getStartDate().getTime();
  const day = Math.floor(diff / 86400000) + 1;
  return Math.min(TOTAL_DAYS, Math.max(1, day));
}

function loadDayData(d){let a=JSON.parse(localStorage.getItem(LS_DATA)||"{}"); return a[d]||{med:{},mood:3,notes:""}}
function saveDayData(d,o){let a=JSON.parse(localStorage.getItem(LS_DATA)||"{}"); a[d]=o; localStorage.setItem(LS_DATA,JSON.stringify(a))}

function renderChart(){
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('chart'),{type:'line',data:{labels:Array.from({length:TOTAL_DAYS},(_,i)=>i+1),datasets:[
    {label:'Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†',data:targets.eso.slice(1),borderColor:'#e74c3c',tension:0.4,fill:false},
    {label:'Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†',data:targets.gab.slice(1).map(x=>x/100),borderColor:'#f39c12',tension:0.4,fill:false},
    {label:'Ù…Ù†Ø´Ø·Ø§Øª',data:targets.stim.slice(1),borderColor:'#3498db',tension:0.4,fill:false}
  ]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}},maintainAspectRatio:false}});
}

function render(){
  currentDay = getCurrentDay();
  document.getElementById("dayIdxLabel").textContent = currentDay;
  document.getElementById("weekLabel").textContent = Math.ceil(currentDay/7);
  document.getElementById("progressText").textContent = Math.round((currentDay-1)/(TOTAL_DAYS-1)*100) + "%";
  document.getElementById("progressBar").style.width = ((currentDay-1)/(TOTAL_DAYS-1)*100) + "%";
  document.getElementById("startDateLabel").textContent = getStartDate().toLocaleDateString('ar-EG');

  document.getElementById("t_eso").textContent = targets.eso[currentDay];
  document.getElementById("t_gab").textContent = targets.gab[currentDay];
  document.getElementById("t_stim").textContent = targets.stim[currentDay];
  document.getElementById("t_caf").textContent = targets.caf[currentDay];

  document.getElementById("targetsText").innerHTML = `Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ† <b>${targets.eso[currentDay]}</b> Ù…Ø¬Ù… ğŸŒ™ â€¢ Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ† <b>${targets.gab[currentDay]}</b> â€¢ Ù…Ù†Ø´Ø·Ø§Øª <b>${targets.stim[currentDay]}</b> âš¡ â€¢ ÙƒØ§ÙÙŠÙŠÙ† â‰¤ <b>${targets.caf[currentDay]}</b> â˜•`;

  document.getElementById("dailyTip").innerHTML = "ğŸ’¡ <b>Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ…:</b><br>" + tips[(currentDay-1)%tips.length];

  const data = loadDayData(currentDay);
  ["eso","gab","stim","caf"].forEach(k=>document.querySelector(`input[data-k="${k}"]`).value = data.med[k]||"");
  document.getElementById("notes").value = data.notes||"";
  setMood(data.mood||3);

  renderChart();
  renderInventory();
}

function setMood(m){currentMood=m; document.querySelectorAll('.mood').forEach((el,i)=>el.classList.toggle('active',i===m-1))}

document.getElementById("saveDay").onclick=()=>{ 
  const data={med:{},mood:currentMood,notes:document.getElementById("notes").value};
  ["eso","gab","stim","caf"].forEach(k=>{let v=document.querySelector(`input[data-k="${k}"]`).value; data.med[k]=v===""?null:Number(v)});
  saveDayData(currentDay,data);
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
};

document.getElementById("prevDay").onclick=()=>{currentDay=Math.max(1,currentDay-1);render();}
document.getElementById("nextDay").onclick=()=>{currentDay=Math.min(TOTAL_DAYS,currentDay+1);render();}

document.getElementById("resetStart").onclick=()=>{
  const s=prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (YYYY-MM-DD)",getStartDate().toISOString().slice(0,10));
  if(s) {localStorage.setItem(LS_START,new Date(s+"T00:00:00").toISOString()); render();}
};

document.getElementById("openInv").onclick=openInventory;
function openInventory(){
  let inv = JSON.parse(localStorage.getItem(LS_INV)||"{}");
  if(Object.keys(inv).length===0){
    inv = {eso:{boxes:0,loose:0}, gab:{boxes:0,loose:0}, stim:{boxes:0,loose:0}};
    localStorage.setItem(LS_INV,JSON.stringify(inv));
  }
  let html="";
  Object.keys(drugInfo).forEach(k=>{
    const i = drugInfo[k];
    const cur = inv[k] || {boxes:0,loose:0};
    html+=`<div style="margin:20px 0;padding:15px;background:#f8f9fa;border-radius:12px">
      <h4>${i.name}</h4>
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø¨ (${i.tabsPerBox} Ù‚Ø±Øµ/Ø¹Ù„Ø¨Ø©): <input type="number" value="${cur.boxes}" data-k="${k}" data-f="boxes"></label><br>
      <label>Ø£Ù‚Ø±Ø§Øµ Ù…ÙØ±Ø¯Ø©: <input type="number" value="${cur.loose}" data-k="${k}" data-f="loose"></label>
    </div>`;
  });
  document.getElementById("invForm").innerHTML=html;
  document.getElementById("invDlg").showModal();
}

document.getElementById("saveInv").onclick=()=>{
  let inv={};
  document.querySelectorAll("#invForm input").forEach(inp=>{
    const k=inp.dataset.k, f=inp.dataset.f;
    if(!inv[k]) inv[k]={};
    inv[k][f]=Number(inp.value)||0;
  });
  localStorage.setItem(LS_INV,JSON.stringify(inv));
  document.getElementById("invDlg").close();
  renderInventory();
};

function renderInventory(){
  const inv = JSON.parse(localStorage.getItem(LS_INV)||"{}");
  const tbody = document.querySelector("#invTable tbody");
  tbody.innerHTML="";
  Object.keys(drugInfo).forEach(k=>{
    const i = drugInfo[k];
    const cur = inv[k] || {boxes:0,loose:0};
    const totalTabs = cur.boxes * i.tabsPerBox + cur.loose;
    const totalMg = totalTabs * i.mg;
    let needed=0;
    for(let d=currentDay; d<=TOTAL_DAYS; d++) needed += targets[k][d];
    const daysLeft = needed===0 ? "âˆ" : Math.floor(totalMg / needed * (TOTAL_DAYS-currentDay+1));
    const row=document.createElement("tr");
    row.innerHTML=`<td><b>${i.name}</b></td><td>${totalTabs} Ù‚Ø±Øµ</td><td>${daysLeft} ÙŠÙˆÙ…</td><td style="font-size:22px">${daysLeft<10?"âš ï¸":"âœ…"}</td>`;
    tbody.appendChild(row);
  });
}

document.getElementById("voiceNote").onclick=()=>{
  const r = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  if(!r) return alert("Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù…ØªØµÙØ­Ùƒ");
  r.lang="ar-SA";
  r.onresult=e=>document.getElementById("notes").value += e.results[0][0].transcript + "\n";
  r.start();
};

render();
setInterval(()=>{if(getCurrentDay()!==currentDay) render();},60000);
</script>
</body>
</html>
