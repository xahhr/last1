<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªØ¹Ø§ÙÙŠ 63 ğŸŒ¿ â€“ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† 15 Ù…Ø¬Ù…</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
body{font-family:'Cairo',sans-serif;background:#f8f9fa;color:#222;margin:0;line-height:1.6}
header{background:#fff;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,0.1);position:sticky;top:0;z-index:10}
h1{font-size:22px;margin:0;background:linear-gradient(90deg,#2ecc71,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.wrap{max-width:1100px;margin:auto;padding:12px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.card{grid-column:span 12;background:#fff;border-radius:16px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
@media(min-width:900px){.half{grid-column:span 6}}
.btn{padding:10px 16px;border:none;border-radius:12px;cursor:pointer;margin:4px;font-size:14px Cairo,sans-serif}
.btn.a{background:#2ecc71;color:#fff}.btn.w{background:#f39c12;color:#fff}
.pill{padding:6px 14px;border-radius:30px;background:#e8f5e9;font-size:13px;display:inline-flex;align-items:center;gap:6px}
.bar{height:10px;background:#eee;border-radius:5px;overflow:hidden;margin:10px 0}
.bar span{display:block;height:100%;background:linear-gradient(90deg,#3498db,#2ecc71);transition:0.5s}
.table{width:100%;border-collapse:collapse;font-size:14px}
.table th{background:#f0f8ff;padding:12px}
.table td{padding:10px;text-align:center;border-bottom:1px solid #eee}
.supp label{display:flex;align-items:center;gap:12px;padding:12px;background:#f8f9fa;border-radius:10px;margin:6px 0;cursor:pointer}
.tip{background:#e8f5ff;padding:16px;border-radius:12px;border-right:5px solid #3498db;margin:12px 0;font-size:15px}
.mood{padding:10px 20px;border-radius:30px;background:#f0f0f0;cursor:pointer;transition:0.3s}
.mood.active{background:#d5f5e3;border:2px solid #2ecc71}
#chart{height:200px !important}
</style>
</head>
<body>

<header>
  <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
    <h1>ØªØ¹Ø§ÙÙŠ 63 ğŸŒ¿ â€“ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† 15 Ù…Ø¬Ù… Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†</h1>
    <div>
      <button class="btn" id="openInv">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ğŸ“¦</button>
      <button class="btn" id="prevDay">â¬… Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      <button class="btn" id="nextDay">Ø§Ù„ØªØ§Ù„ÙŠ â¡</button>
      <button class="btn w" id="resetStart">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ğŸ“…</button>
      <button class="btn a" id="saveDay">Ø­ÙØ¸ Ø§Ù„ÙŠÙˆÙ… âœ…</button>
    </div>
  </div>
  <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap;align-items:center">
    <span class="pill">Ø¨Ø¯Ø¡: <b id="startDateLabel"></b></span>
    <span class="pill">ÙŠÙˆÙ… <b id="dayIdxLabel">1</b>/63</span>
    <span class="pill">Ø£Ø³Ø¨ÙˆØ¹ <b id="pill">ØªÙ‚Ø¯Ù… <b id="progressText">0%</b></span>
    <div class="bar" style="flex:1"><span id="progressBar" style="width:0%"></span></div>
  </div>
</header>

<div class="wrap"><div class="grid">

  <div class="card" id="chartCard"><h3>Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨ ğŸ“‰</h3><canvas id="chart"></canvas></div>

  <div class="card"><h3>Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… ğŸ¯</h3><p id="targetsText" style="font-size:19px;font-weight:600"></p></div>

  <div class="card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
    <table class="table">
      <tr><th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th><th>Ø§Ù„Ù‡Ø¯Ù</th><th>Ø£ÙØ®Ø°</th></tr>
      <tr><td>Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†</td><td id="t_eso">15</td><td><input type="number" step="0.5" data-k="eso" style="width:100px;padding:8px"></td></tr>
      <tr><td>Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†</td><td id="t_gab">2200</td><td><input type="number" step="50" data-k="gab" style="width:100px;padding:8px"></td></tr>
      <tr><td>Ù…Ù†Ø´Ø·Ø§Øª</td><td id="t_stim">650</td><td><input type="number" step="25" data-k="stim" style="width:100px;padding:8px"></td></tr>
      <tr><td>ÙƒØ§ÙÙŠÙŠÙ† â‰¤</td><td id="t_caf">350</td><td><input type="number" step="10" data-k="caf" style="width:100px;padding:8px"></td></tr>
    </table>
    <button class="btn" id="voiceNote">ğŸ¤ Ù…Ù„Ø§Ø­Ø¸Ø© ØµÙˆØªÙŠØ©</button>
  </div>

  <div class="card">
    <h3>Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ… Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨ ğŸ’¡</h3>
    <div id="dailyTip" class="tip"></div>
  </div>

  <div class="card half">
    <h3>Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ğŸ’Š</h3>
    <div class="supp">
      <label><input type="checkbox" id="s1"> Ù…ØºÙ†ÙŠØ³ÙŠÙˆÙ… Ø¬Ù„Ø§ÙŠØ³ÙŠÙ†Ø§Øª 400 Ù…Ø¬Ù…</label>
      <label><input type="checkbox" id="s2"> Ù„Ù€ Ø«ÙŠØ§Ù†ÙŠÙ† 200â€“400 Ù…Ø¬Ù…</label>
      <label><input type="checkbox" id="s3"> Ù…ÙŠÙ„Ø§ØªÙˆÙ†ÙŠÙ† 0.5â€“1 Ù…Ø¬Ù…</label>
      <label><input type="checkbox" id="s4"> Ø£ÙˆÙ…ÙŠØ¬Ø§-3 Ø¹Ø§Ù„ÙŠ EPA</label>
      <label><input type="checkbox" id="s5"> ÙÙŠØªØ§Ù…ÙŠÙ† Ø¯ 5000 ÙˆØ­Ø¯Ø©</label>
      <label><input type="checkbox" id="s6"> ÙÙŠØªØ§Ù…ÙŠÙ† Ø¨ Ù…Ø±ÙƒØ¨</label>
    </div>
  </div>

  <div class="card half">
    <h3>Ù…Ø²Ø§Ø¬Ùƒ Ø§Ù„ÙŠÙˆÙ…</h3>
    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:15px 0">
      <span class="mood" onclick="setMood(1)">ğŸ˜”</span>
      <span class="mood" onclick="setMood(2)">ğŸ˜°</span>
      <span class="mood active" onclick="setMood(3)">ğŸ˜</span>
      <span class="mood" onclick="setMood(4)">ğŸ™‚</span>
      <span class="mood" onclick="setMood(5)">ğŸ˜</span>
    </div>
    <textarea id="notes" rows="4" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…..."></textarea>
  </div>

  <div class="card">
    <h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ğŸ“¦</h3>
    <table class="table" id="invTable"><tbody></tbody></table>
  </div>

</div></div>

<dialog id="invDlg">
  <form method="dialog" style="padding:20px">
    <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
    <div id="invForm"></div>
    <div style="margin-top:20px;text-align:left">
      <button class="btn" value="cancel">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn a" id="saveInv">Ø­ÙØ¸</button>
    </div>
  </form>
</dialog>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const TOTAL_DAYS = 63;
const LS_START = "t63_start", LS_DATA = "t63_data", LS_INV = "t63_inv";
let currentDay = 1, currentMood = 3, chart = null;

// Ø§Ù„Ø®Ø·Ø© 63 ÙŠÙˆÙ…
const targets = {
  eso:[0,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,14,14,14,14,12,12,12,12,12,12,12,10,10,10,10,10,10,10,8,8,8,8,8,8,8,6,6,6,6,6,6,6,4,4,4,4,4,4,4,2,2,2,1,1,1,0],
  gab:[0,2200,2200,2200,2200,2200,2200,2200,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,1800,1800,1800,1800,1800,1600,1600,1600,1600,1600,1600,1600,1400,1400,1400,1400,1400,1400,1400,1200,1200,1200,1200,1200,1200,1200,1000,1000,1000,1000,1000,1000,1000,800,800,800,800,800,800,800,600,600,600,300,300,300,0],
  stim:[0,650,650,650,650,650,650,650,600,600,600,600,600,600,600,600,600,600,600,600,550,550,550,550,550,500,500,500,500,500,500,500,400,400,400,400,400,400,400,300,300,300,300,300,300,300,200,200,200,200,200,200,200,100,100,100,100,100,100,100,50,50,50,0,0,0,0],
  caf:[0,350,350,350,350,350,350,350,300,300,300,300,300,300,300,300,300,300,300,300,250,250,250,250,250,200,200,200,200,200,200,200,150,150,150,150,150,150,150,100,100,100,100,100,100,100,75,75,75,75,75,75,75,50,50,50,50,50,50,50,30,30,30,10,10,10,0]
};

const tips = ["ğŸ’§ Ø§Ø´Ø±Ø¨ 3â€“4 Ù„ØªØ± Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠÙ‹Ø§","ğŸ§˜â€â™‚ï¸ Ù…ØºÙ†ÙŠØ³ÙŠÙˆÙ… Ø¬Ù„Ø§ÙŠØ³ÙŠÙ†Ø§Øª = Ø³Ø­Ø± Ù„Ù„Ù‚Ù„Ù‚","ğŸƒâ€â™‚ï¸ 20 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø´ÙŠ ÙŠÙˆÙ…ÙŠÙ‹Ø§","â˜• Ù„Ø§ ÙƒØ§ÙÙŠÙŠÙ† Ø¨Ø¹Ø¯ 2 Ø¸Ù‡Ø±Ù‹Ø§","ğŸ› Ø­Ù…Ø§Ù… Ù…Ù„Ø­ Ø¥Ø¨Ø³ÙˆÙ…","ğŸŒ¬ ØªÙ†ÙØ³ 4-7-8","ğŸŸ Ø£ÙˆÙ…ÙŠØ¬Ø§-3 Ø¹Ø§Ù„ÙŠ EPA","â° Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù†ÙˆÙ… Ø«Ø§Ø¨ØªØ©"];

function getStartDate(){
  let s = localStorage.getItem(LS_START);
  if(!s){let d=new Date();d.setHours(0,0,0,0);localStorage.setItem(LS_START,d.toISOString());s=d.toISOString();}
  return new Date(s);
}
function getCurrentDay(){
  let diff = Date.now() - getStartDate().getTime();
  return Math.min(TOTAL_DAYS, Math.max(1, Math.floor(diff / 86400000) + 1));
}

function loadDayData(day){
  let all = JSON.parse(localStorage.getItem(LS_DATA) || "{}");
  return all[day] || {med:{}, mood:3, notes:""};
}
function saveDayData(day, data){
  let all = JSON.parse(localStorage.getItem(LS_DATA) || "{}");
  all[day] = data;
  localStorage.setItem(LS_DATA, JSON.stringify(all));
}

function renderChart(){
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('chart'), {
    type: 'line',
    data: {
      labels: Array.from({length:TOTAL_DAYS},(_,i)=>i+1),
      datasets: [
        {label:'Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†',data:targets.eso.slice(1),borderColor:'#e74c3c',tension:0.4,fill:false},
        {label:'Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†',data:targets.gab.slice(1).map(x=>x/100),borderColor:'#f39c12',tension:0.4,fill:false},
        {label:'Ù…Ù†Ø´Ø·Ø§Øª',data:targets.stim.slice(1),borderColor:'#3498db',tension:0.4,fill:false}
      ]
    },
    options: {plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}},maintainAspectRatio:false}
  });
}

function render(){
  currentDay = getCurrentDay();
  document.getElementById("dayIdxLabel").textContent = currentDay;
  document.getElementById("progressText").textContent = Math.round(currentDay/TOTAL_DAYS*100)+"%";
  document.getElementById("progressBar").style.width = (currentDay/TOTAL_DAYS*100)+"%";
  document.getElementById("startDateLabel").textContent = getStartDate().toLocaleDateString('ar-EG');

  document.getElementById("t_eso").textContent = targets.eso[currentDay];
  document.getElementById("t_gab").textContent = targets.gab[currentDay];
  document.getElementById("t_stim").textContent = targets.stim[currentDay];
  document.getElementById("t_caf").textContent = targets.caf[currentDay];

  document.getElementById("targetsText").innerHTML = `Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ† <b>\( {targets.eso[currentDay]}</b> Ù…Ø¬Ù… ğŸŒ™ â€¢ Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ† <b> \){targets.gab[currentDay]}</b> â€¢ Ù…Ù†Ø´Ø·Ø§Øª <b>\( {targets.stim[currentDay]}</b> âš¡ â€¢ ÙƒØ§ÙÙŠÙŠÙ† â‰¤ <b> \){targets.caf[currentDay]}</b> â˜•`;

  document.getElementById("dailyTip").innerHTML = "ğŸ’¡ <b>Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ…:</b> " + tips[(currentDay-1)%tips.length];

  let data = loadDayData(currentDay);
  ["eso","gab","stim","caf"].forEach(k => document.querySelector(`input[data-k="${k}"]`).value = data.med[k] || "");
  document.getElementById("notes").value = data.notes || "";
  setMood(data.mood || 3);

  renderChart();
  renderInventory();
}

function setMood(m){
  currentMood = m;
  document.querySelectorAll('.mood').forEach((el,i)=>el.classList.toggle('active',i===m-1));
}

document.getElementById("saveDay").onclick = ()=>{
  let data = {med:{}, mood:currentMood, notes:document.getElementById("notes").value};
  ["eso","gab","stim","caf"].forEach(k=> {
    let v = document.querySelector(`input[data-k="${k}"]`).value;
    data.med[k] = v==="" ? null : Number(v);
  });
  saveDayData(currentDay, data);
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
};

document.getElementById("prevDay").onclick = () => {currentDay = Math.max(1,currentDay-1); render();}
document.getElementById("nextDay").onclick = () => {currentDay = Math.min(TOTAL_DAYS,currentDay+1); render();}

document.getElementById("resetStart").onclick = ()=>{
  let s = prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ (YYYY-MM-DD)", getStartDate().toISOString().slice(0,10));
  if(s){
    localStorage.setItem(LS_START, new Date(s).toISOString());
    render();
  }
};

document.getElementById("voiceNote").onclick = ()=>{
  let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition) return alert("Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…");
  let r = new SpeechRecognition();
  r.lang = "ar";
  r.onresult = e => document.getElementById("notes").value += e.results[0][0].transcript + " ";
  r.start();
};

// Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¨Ø³ÙŠØ·
function renderInventory(){
  let inv = JSON.parse(localStorage.getItem(LS_INV)||"{}");
  if(Object.keys(inv).length===0){
    inv = {eso:{mg:3,box:20,boxes:5,loose:0},gab:{mg:300,box:30,boxes:3,loose:0},stim:{mg:150,box:30,boxes:2,loose:0}};
    localStorage.setItem(LS_INV,JSON.stringify(inv));
  }
  let html = "";
  for(let k in inv){
    let name = k==="eso"?"Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†":k==="gab"?"Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†":"Ù…Ù†Ø´Ø·Ø§Øª";
    let tabs = inv[k].boxes*inv[k].box + inv[k].loose;
    html += `<tr><td>\( {name}</td><td> \){tabs} Ù‚Ø±Øµ</td><td>\( {inv[k].boxes} Ø¹Ù„Ø¨Ø© + \){inv[k].loose} Ù‚Ø±Øµ</td><td><button class="btn" onclick="editInv('${k}')">ØªØ¹Ø¯ÙŠÙ„</button></td></tr>`;
  }
  document.querySelector("#invTable tbody").innerHTML = html || "<tr><td colspan=4>Ø§Ø¶ØºØ· Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯</td></tr>";
}
window.editInv = function(k){alert("Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§ â€“ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ø¹Ø¯Ù‘Ù„ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø©")}

render();
setInterval(()=>{if(getCurrentDay() !== currentDay) render();}, 60000);
</script>
</body>
</html>
